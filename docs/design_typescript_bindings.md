# Design: TypeScript/Node.js Bindings

**Status:** First slice in progress  
**Related:** [design_roadmap.md](design_roadmap.md)

## Goal

Provide idiomatic TypeScript/Node.js bindings for AgentMemDB via napi-rs (Node-API). Enables JS/TS agent frameworks to use episodic memory without Python.

## Approach

- **napi-rs:** Rust → Node-API (N-API) native addon. No node-gyp; prebuilt binaries for common platforms.
- **Package layout:** `node/` directory with Rust crate + npm package.
- **API surface:** Mirror Python: AgentMemDB, Episode, store_episode, query_similar.

## First Slice API

```typescript
import { AgentMemDB, Episode } from 'agent_mem_db';

const db = new AgentMemDB(768);
const ep = new Episode('task1', embedding, 0.9);
db.storeEpisode(ep);
const hits = db.querySimilar(embedding, 0.0, 5);
```

### Classes

- **AgentMemDB(dim: number)** — in-memory DB
- **AgentMemDB.exact(dim)** — exact search backend
- **AgentMemDB.withMaxElements(dim, maxElements)** — scale
- **Episode** — taskId, stateEmbedding, reward; optional metadata, timestamp, tags
- **storeEpisode(episode)** — void
- **querySimilar(embedding, minReward, topK, opts?)** — Episode[]
- **saveToFile(path)**, **loadFromFile(path)** — persistence

### Query Options (optional)

```typescript
db.querySimilar(embedding, 0.0, 5, {
  tagsAny: ['coding'],
  timeAfter: 1000,
  timeBefore: 2000,
});
```

## Build

- `npm run build` — compiles Rust to `.node` binary
- TypeScript definitions generated by napi-rs
- Optional: `@napi-rs/cli` for multi-platform packaging

## Future

- AgentMemDBDisk bindings
- Async APIs (if napi supports)
- ESM + CJS dual package
